<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>예제</title>
  <style>
    h2 {
      margin-top: 40px;
    }

    .bg {
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      position: fixed;
      z-index: 100;
    }
    .content {
      position: relative;
      width: 572px;
      margin: 50px auto 0;
    }
    .content .close_btn {
      color: #fff;
      position: absolute;
      top: -26px;
      right: -27px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    .somun_form input {
      width: 280px;
    }
    table {
      border: 1px solid #999;
    }
  </style>
</head>
<body>
<div id="app"></div>

<script
        src="https://unpkg.com/react@17/umd/react.development.js";
        crossorigin
></script>
<script
        src="https://unpkg.com/react-dom@17/umd/react-dom.development.js";
        crossorigin
></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js";></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script type="text/babel">
    const Title = (props) => {
        return <h2>{props.children}</h2>;
    };

    const BookList = ( props) => {
        const [isChecked, setIsChecked] = React.useState(false);

        function radiotest(e){
            console.log(props)
            props.setPrice2(props.bookItem.price);
        }

        function checktest(e){

            if (!isChecked) {
                console.log("aa");
                setIsChecked(true);
                props.setPrice(props.price + props.bookItem.price);
            } else {
                console.log("bb");
                setIsChecked(false);
                props.setPrice(props.price - props.bookItem.price);
            }

        }

        function onChangeInput(e) {
            // const isChecked = e.target.checked;
            e.target.type === "radio" ? radiotest(e) : checktest(e)

        }

        return (
            <li>
                <input
                    type={props.bookItem.inputType}
                    name="book"
                    id={props.bookItem.id}
                    onChange={onChangeInput}

                    value={props.bookItem.price}
                />
                <label htmlFor={props.bookItem.id}>
                    {props.bookItem.title}: {props.bookItem.price}원
                </label>
            </li>
        );
    };

    const BookListForm = () => {
        const bookItems = [
            {
                title: "해커스 왕기초",
                inputType: "radio",
                price: 20000,
                id: "book1",
            },
            {
                title: "해커스 첫토익",
                inputType: "radio",
                price: 30000,
                id: "book2",
            },
            {
                title: "그래머게이트웨이",
                inputType: "checkbox",
                price: 20000,
                id: "book3",
            },
        ];

        const [price, setPrice] = React.useState(120000);
        const [price2, setPrice2] = React.useState(0);


        return (
            <div>
                <form>
                    <ul>
                        <BookList
                            bookItem={bookItems[0]}
                            price={price}
                            setPrice={setPrice}
                            price2={price2}
                            setPrice2={setPrice2}

                        />
                        <BookList
                            bookItem={bookItems[1]}
                            price={price}
                            setPrice={setPrice}
                            price2={price2}
                            setPrice2={setPrice2}
                        />
                        <BookList
                            bookItem={bookItems[2]}
                            price={price}
                            setPrice={setPrice}
                            price2={price2}
                            setPrice2={setPrice2}
                        />
                    </ul>
                    <p>총 강의 금액: {`${price + price2}`}원</p>
                    <button>수강신청</button>
                </form>
            </div>
        );
    };

    const ApplyLect = () => {
        return (
            <div>
                <Title>수강신청</Title>
                <BookListForm />
            </div>
        );
    };

    const Popup = () => {
        const [popupOn, setPopupOn] = React.useState(false);

        const openPopup = () => {
            setPopupOn(!popupOn);
        };

        const PopupContent = () => {
            return (
                <div className="bg">
                    <div className="content">
                        <img
                            src="//gscdn.hackers.co.kr/champ/img/event/2019/07/2200/pc/type3/v1/curri_pop_500_01.jpg"
                            alt=""
                        />
                        <button className="close_btn" onClick={openPopup}>
                            X
                        </button>
                    </div>
                </div>
            );
        };

        return (
            <div>
                <Title>팝업</Title>
                <button onClick={openPopup}>강의 커리큘럼 보기</button>
                {popupOn ? <PopupContent /> : ""}
            </div>
        );
    };

    const SomunInput = ({ value, setValue, updateList }) => {
        const [noticeMessage, setNoticeMessage] = React.useState("");
        const writeText = (e) => {
            setValue(e.target.value);
        };

        const submitSomunForm = (e) => {
            e.preventDefault();
            if (value === "") {
                setNoticeMessage("url을 입력해주세요");
                return;
            }
            setValue("");
            updateList();
        };

        return (
            <div>
                <form className="somun_form" onSubmit={submitSomunForm}>
                    <input
                        type="text"
                        placeholder="url을 입력하세요"
                        onChange={writeText}
                        value={value}
                    />
                    <button>인증하기</button>
                </form>
                <p>{noticeMessage}</p>
            </div>
        );
    };

    const SomunList = ({ list }) => {
        return (
            <table>
                <colgroup>
                    <col style={{ width: "70%" }} />
                    <col />
                </colgroup>
                <tbody>
                <tr>
                    <td>URL</td>
                    <td>등록일자</td>
                </tr>
                {list.map((list, index) => (
                    <tr id={list.id} key={index}>
                        <td>{list.url}</td>
                        <td>{list.regDate}</td>
                    </tr>
                ))}
                </tbody>
            </table>
        );
    };

    const SomunEvent = () => {
        $.ajax({
            url: "./event-list.json",
            type: "GET",
            dataType: "json",
            success: function(data) {
                console.log(data)
            }
        });
        // const GET_DATA = "";
        // const response = fetch(GET_DATA).then((res) => console.log(res));
        // //const responseJson = await response.json();
        // console.log(response);



        const initialList = [
            {
                id: "1",
                url: "https://example.com",
                regDate: "2022-04-22",
            },
            {
                id: "2",
                url: "https://example.com",
                regDate: "2022-04-22",
            },
            {
                id: "3",
                url: "https://example.com",
                regDate: "2022-04-22",
            },
            {
                id: "4",
                url: "https://example.com",
                regDate: "2022-04-22",
            },
        ];

        const submitDate =
            new Date().getMonth() < 9
                ? new Date().getFullYear().toString() +
                "-0" +
                (new Date().getMonth() + 1).toString() +
                "-" +
                new Date().getDate().toString()
                : new Date().getFullYear().toString() +
                "-" +
                (new Date().getMonth() + 1).toString() +
                "-" +
                new Date().getDate().toString();

        const [list, setList] = React.useState(initialList);
        const [value, setValue] = React.useState("");

        // async function updateList() {
        //  const newList = await fetchList();
        //  setList([...newList, { url: value, regDate: submitDate }]);
        // }

        function updateList() {
            setList([...list, { url: value, regDate: submitDate }]);
        }

        return (
            <div>
                <Title>소문내기 이벤트</Title>
                <SomunInput
                    value={value}
                    setValue={setValue}
                    updateList={updateList}
                />
                <SomunList list={list} />
            </div>
        );
    };

    const App = () => {
        return (
            <div>
                <ApplyLect />
                <Popup />
                <SomunEvent />
            </div>
        );
    };

    const here = document.querySelector("#app");

    ReactDOM.render(<App />, here);
</script>
</body>
</html>